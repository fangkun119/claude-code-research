# Document Pyramid Rewrite Command

基于金字塔原理的智能文档重写工具，用于改写markdown文档的章节内容，保持信息完整性的同时提升表达结构。

## Usage

```markdown
/md-pyramid-rewrite "input_file_path" "requirements"
```

## Parameters

- `input_file_path`: 输入的markdown文件路径
- `requirements`: 用户自定义的改写需求（可选，默认空字符串）

## Output

改写后的完整markdown内容直接输出到标准输出，保持原有文件不变。在满足金字塔原理的基础上，兼顾用户的自定义需求。

## 输出格式要求

- **强制UTF-8纯文本输出**：必须以UTF-8编码的纯文本格式输出，严禁任何二进制格式
- **标准输出**：直接输出到标准输出流，不写入文件
- **编码保证**：确保所有中文字符和特殊符号正确显示

## 核心功能

### 1. 金字塔原理改写
- **结论先行**：每个段落开头用**加粗**显示核心结论
- **列表转换**：3个及以上并列内容转换为列表，目标70%+列表化
- **逻辑层次**：核心结论→主要论据→具体例证的三层结构

### 2. 论述结构识别与保留
- **智能识别**：自动识别8种核心论述结构
- **词汇保留**：保留原文中标志论述方法的关键词汇
- **逻辑保护**：保持原有论证逻辑关系和说服力

### 3. 核心论述结构与凸显词汇

#### 逻辑推理类
- **逻辑推理**：基于...可以推断出、因此、由此可见
- **因果分析**：究其原因、这导致了...、根本原因是...

#### 证据支撑类
- **例证支撑**：以...为例、这个例子清楚地表明...、充分证明了...
- **数据支撑**：数据显示...、统计表明...、这些数字充分说明...
- **引用支撑**：根据...研究显示、专家认为...、研究结果证实了...

#### 对比分析类
- **对比分析**：相比之下、前者...而后者...、更具有优势
- **类比论证**：正如...一样、同样地...、这个类比告诉我们...

#### 权威支撑类
- **权威引用**：正如...所言、权威机构指出、具有权威性

## 绝对保留元素（最高优先级）

以下元素必须100%完整保留，一个字符都不能少：

- **源代码**：
  - 代码块：```包围的代码块必须100%完整保留
  - 行内代码：`包围的代码必须100%完整保留

- **图片元素（最高优先级）**：
  - Markdown格式：`![alt文本](图片路径)`，都完整保留，和原文中的一模一样
  - HTML img标签（不论多长都保留）：`<img src="..." alt="..." ...>` 都完整保护，和原文中的标签一模一样

- **超链接**：所有`[链接文本](URL)`都完整保留，和原文中的一模一样

- **HTML及第三方标签**：所有内嵌的HTML标签（如`<div>`、`<span>`、`<a href="">`等）和第三方标签（如`<Card>`等）都完整保留，和原文中的一模一样

## 处理流程

### 四步标准化流程
1. **文件读取**：读取输入的markdown文件，解析标题和内容结构
2. **需求分析**：解析用户自定义需求，确定改写重点和风格要求
3. **内容重写**：按金字塔原理重写章节内容，在满足核心原则基础上兼顾用户需求
4. **完整输出**：输出完整的markdown文档，包含原始标题和重写后内容

### 智能内容处理
- **论述性内容**：保留逻辑推理和证据支撑方式
- **叙事性内容**：保持时间顺序，保留关键事件
- **说明性内容**：规范步骤说明，保持逻辑清晰
- **代码块**：完整保留无修改
- **标题结构**：保持原有标题层级不变

## 质量标准

### 优先级顺序

**绝对保留元素 > 信息完整性 > 金字塔原理 > 论述结构保留 > 用户需求 > 语言优化**

### 质量检查清单

| 检查项目 | 要求 | 状态 |
|---------|------|------|
| **金字塔原理应用** | 每个段落以**加粗结论**开头 | ✅ |
| **列表化目标** | 70%+内容为列表格式 | ✅ |
| **论述结构保护** | 核心论述结构词汇得到保留 | ✅ |
| **信息完整性** | 信息完整无遗漏 | ✅ |
| **逻辑层次** | 逻辑层次清晰分明 | ✅ |
| **标题结构** | 原始标题结构完全保持 | ✅ |
| **文件操作** | 不修改输入文件 | ✅ |
| **输出格式** | 强制UTF-8纯文本输出 | ✅ |
| **中文显示** | 中文字符正常显示，无乱码 | ✅ |
| **源代码保留** | 源代码块100%完整保留 | ✅ |
| **行内代码保留** | 行内代码100%完整保留 | ✅ |
| **超链接保留** | 所有超链接完整保留 | ✅ |
| **图片元素保留** | 所有图片元素100%完整保留 | ✅ |
| **HTML和第三方标签保留** | 所有HTML和第三方标签完整保留 | ✅ |

## AI执行规则

你是一位专业的金字塔原理写作专家。请按以下规则重写markdown文档：

### 核心执行原则

**优先级顺序**：绝对保留元素 > 信息完整性 > 金字塔原理 > 论述结构保留 > 用户需求 > 语言优化

### 必须执行的金字塔原理

1. **结论先行**：章节内容段落开头用**加粗**显示核心结论
2. **列表转换**：3个及以上并列内容必须转换为列表格式
3. **列表化目标**：70%+内容以列表形式呈现
4. **信息完整**：保持信息完整性，不丢失不添加内容
5. **标题保护**：完全保持原始标题结构和层级

### 绝对保留元素（最高优先级）

- **源代码**：```代码块和`行内代码`必须100%完整保留
- **图片元素**：Markdown和HTML格式的图片必须100%完整保留，包括所有属性
- **超链接**：所有[链接文本](URL)必须完整保留
- **HTML和第三方标签**：所有内嵌HTML和第三方标签必须完整保留

### 处理流程

1. **解析**：读取markdown文件，识别结构
2. **需求分析**：解析requirements参数
3. **重写**：按金字塔原理重组内容
4. **输出**：输出完整markdown文档

### 内容类型处理

- **论述性**：保留8种论述结构的关键词汇
- **叙事性**：保持时间顺序，突出关键事件和人物
- **说明性**：保持说明方法和逻辑顺序
- **代码块**：完全保留无修改

### 输出要求

- UTF-8纯文本格式输出到标准输出
- 不修改输入文件
- 确保中文字符正常显示

请根据用户提供的requirements参数灵活调整风格，但严格遵守上述核心原则。

## 使用示例

### 基础使用
```markdown
/md-pyramid-rewrite "document.md" ""
```

### 带自定义需求的使用
```markdown
/md-pyramid-rewrite "document.md" "突出技术优势，使用更正式的商业语言，适合高管汇报"
```

### 针对特定场景的需求
```markdown
/md-pyramid-rewrite "technical_doc.md" "简化技术术语，使非技术人员也能理解"
```

```markdown
/md-pyramid-rewrite "research_report.md" "强调数据支撑，增强说服力，适合学术报告"
```

## 常见问题解答

### Q: requirements参数支持哪些类型的自定义需求？
A: 支持语言风格调整、重点内容突出、特定术语使用、表达方式偏好等，但不能违反绝对保留元素的要求。

### Q: 如何处理包含大量代码的技术文档？
A: 所有代码块（```）和行内代码（`）都会100%完整保留，不受金字塔原理改写影响。

### Q: 图片和链接在改写过程中会如何处理？
A: 所有Markdown和HTML格式的图片、超链接都会100%完整保留，包括所有属性。

### Q: 改写后的文档会保持原有的格式吗？
A: 是的，完全保持原始标题结构和层级，只对章节内容按金字塔原理重组。

### Q: 如果用户需求与金字塔原理冲突怎么办？
A: 按优先级顺序处理：绝对保留元素 > 信息完整性 > 金字塔原理 > 用户需求。

## 注意事项

- **文件安全**：仅读取输入文件，不修改原文件
- **内容完整性**：保持原文所有信息不丢失不添加
- **格式兼容**：输出UTF-8编码的markdown文档
- **需求灵活性**：requirements参数支持合理的改写需求，但需遵守核心原则
- **代码格式准确**：严格确保源代码用```包裹（起始和结束各三个`，不多也不少），行内代码用`包裹（起始和结束各一个`，不多也不少），避免影响文档展现